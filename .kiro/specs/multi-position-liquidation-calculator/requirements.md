# เอกสารความต้องการ - Multi-Position Liquidation Calculator

## บทนำ

ฟีเจอร์นี้จะเป็นการต่อยอดจาก Binance Futures Calculator เดิม โดยเพิ่มความสามารถในการคำนวณ liquidation price สำหรับการเปิด position หลายไม้ (multiple positions) ในคู่เทรดเดียวกัน ซึ่งจะช่วยให้เทรดเดอร์สามารถวิเคราะห์และวางแผนการถัวเฉลี่ย (Dollar Cost Averaging) ได้อย่างมีประสิทธิภาพ โดยไม่ให้ราคา liquidation อยู่ในระดับที่เสี่ยงต่อการปิด position

## ความต้องการ

### ความต้องการ 1

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการปรับปรุง UI ของเครื่องคำนวณเดิมให้ทำงานได้ดีขึ้น เพื่อที่ฉันจะได้ใช้งานได้อย่างราบรื่นและมีประสิทธิภาพ

#### เกณฑ์การยอมรับ

1. เมื่อคลิก Position side (Long/Short) ระบบจะต้องเปลี่ยนสีและแสดงสถานะที่เลือกอย่างชัดเจน
2. เมื่อเปิด Trading pair dropdown ระบบจะต้องแสดง background ที่ไม่โปร่งใส เพื่อให้อ่านง่าย
3. เมื่อเปลี่ยนค่า entryPrice, quantity, หรือ leverage ระบบจะต้องไม่คำนวณ liquidation price ทันที
4. เมื่อคลิกปุ่ม "Calculate" ระบบจะต้องคำนวณและแสดงผลลัพธ์
5. ใน Calculation Details ระบบจะต้องไม่แสดง "Max Leverage" แต่แสดง "Current Leverage" ที่ใช้ในการคำนวณแทน

### ความต้องการ 2

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการเครื่องคำนวณ liquidation price แบบหลายไม้ เพื่อที่ฉันจะสามารถวางแผนการถัวเฉลี่ยและวิเคราะห์ผลกระทบต่อ liquidation price ได้

#### เกณฑ์การยอมรับ

1. เมื่อเข้าใช้ฟีเจอร์ multi-position ระบบจะต้องแสดง tab menu ใหม่แยกจากเครื่องคำนวณเดิม
2. เมื่อเลือก tab multi-position ระบบจะต้องแสดงหน้าจอการคำนวณแบบหลายไม้
3. เมื่อใช้งานฟีเจอร์ multi-position ระบบจะต้องให้เลือก trading pair, leverage, position side และ balance เหมือนเครื่องคำนวณเดิม
4. เมื่อตั้งค่าพื้นฐานเสร็จ ระบบจะต้องแสดงตารางสำหรับป้อนข้อมูลแต่ละไม้

### ความต้องการ 3

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการตารางที่สามารถเพิ่ม row ได้ไม่จำกัด เพื่อที่ฉันจะสามารถป้อนข้อมูลการเปิด position หลายไม้ได้ตามต้องการ

#### เกณฑ์การยอมรับ

1. เมื่อดูตาราง ระบบจะต้องแสดงคอลัมน์ "Order Price" และ "Quantity" สำหรับป้อนข้อมูล
2. เมื่อดูตาราง ระบบจะต้องแสดงคอลัมน์ "Liquidation Price" ทางขวาสุดสำหรับแสดงผลลัพธ์
3. เมื่อคลิกปุ่ม "Add Position" ระบบจะต้องเพิ่ม row ใหม่ในตาราง
4. เมื่อมี row มากกว่า 1 row ระบบจะต้องแสดงปุ่ม "Remove" สำหรับลบ row ที่ไม่ต้องการ
5. เมื่อป้อนข้อมูลในตาราง ระบบจะต้องตรวจสอบว่าเป็นตัวเลขบวกที่ถูกต้อง

### ความต้องการ 4

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการเห็นการคำนวณ liquidation price แบบสะสม เพื่อที่ฉันจะเข้าใจว่าการเพิ่มแต่ละไม้จะส่งผลต่อ liquidation price อย่างไร

#### เกณฑ์การยอมรับ

1. เมื่อคลิกปุ่ม "Calculate" ระบบจะต้องคำนวณ liquidation price สำหรับแต่ละ row แบบสะสม
2. เมื่อคำนวณ row แรก ระบบจะต้องแสดง liquidation price ของ position เดียว
3. เมื่อคำนวณ row ที่สอง ระบบจะต้องแสดง liquidation price ของ position รวม (row 1 + row 2)
4. เมื่อคำนวณ row ถัดไป ระบบจะต้องแสดง liquidation price ของ position รวมทั้งหมดจนถึง row นั้น
5. เมื่อมีข้อมูลไม่ครบหรือผิดพลาด ระบบจะต้องแสดงข้อความแจ้งเตือนในช่อง liquidation price

### ความต้องการ 5

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการเห็นข้อมูลสรุปของ position รวม เพื่อที่ฉันจะสามารถวิเคราะห์ความเสี่ยงโดยรวมได้

#### เกณฑ์การยอมรับ

1. เมื่อคำนวณเสร็จ ระบบจะต้องแสดงข้อมูลสรุป Total Position Size
2. เมื่อคำนวณเสร็จ ระบบจะต้องแสดงข้อมูลสรุป Average Entry Price
3. เมื่อคำนวณเสร็จ ระบบจะต้องแสดงข้อมูลสรุป Final Liquidation Price
4. เมื่อคำนวณเสร็จ ระบบจะต้องแสดงข้อมูลสรุป Total Margin Used
5. เมื่อคำนวณเสร็จ ระบบจะต้องแสดงข้อมูลสรุป Remaining Balance

### ความต้องการ 6

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการให้ระบบตรวจสอบความถูกต้องของข้อมูล เพื่อป้องกันการคำนวณที่ผิดพลาด

#### เกณฑ์การยอมรับ

1. เมื่อ Total Margin Used เกิน Balance ระบบจะต้องแสดงคำเตือนและไม่อนุญาตให้คำนวณ
2. เมื่อ Order Price ต่ำกว่า Liquidation Price ของ row ก่อนหน้า (สำหรับ Long) ระบบจะต้องแสดงคำเตือน
3. เมื่อ Order Price สูงกว่า Liquidation Price ของ row ก่อนหน้า (สำหรับ Short) ระบบจะต้องแสดงคำเตือน
4. เมื่อมีข้อมูลไม่ครบในแถวใดแถวหนึ่ง ระบบจะต้องแสดงข้อความแจ้งเตือน
5. เมื่อ Quantity เป็น 0 หรือติดลบ ระบบจะต้องแสดงข้อความแสดงข้อผิดพลาด

### ความต้องการ 7

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการ UI ที่ใช้งานง่ายและเข้าใจได้ง่าย เพื่อที่ฉันจะสามารถใช้งานได้อย่างมีประสิทธิภาพ

#### เกณฑ์การยอมรับ

1. เมื่อดูหน้าจอ ระบบจะต้องแสดง UI ที่เป็นระเบียบและแบ่งส่วนชัดเจน
2. เมื่อใช้งานบนมือถือ ระบบจะต้องแสดงผลได้อย่างเหมาะสมและใช้งานได้
3. เมื่อมีข้อผิดพลาด ระบบจะต้องแสดงข้อความที่เข้าใจง่ายเป็นภาษาไทย
4. เมื่อกำลังคำนวณ ระบบจะต้องแสดง loading indicator
5. เมื่อคำนวณเสร็จ ระบบจะต้องไฮไลท์ผลลัพธ์ให้เห็นชัดเจน

### ความต้องการ 8

**User Story:** ในฐานะเทรดเดอร์ futures ฉันต้องการให้ระบบใช้ข้อมูลและสูตรการคำนวณที่แม่นยำเหมือน Binance เพื่อให้ผลลัพธ์ถูกต้องและเชื่อถือได้

#### เกณฑ์การยอมรับ

1. เมื่อคำนวณ liquidation price ระบบจะต้องใช้สูตรเดียวกับที่ใช้ในเครื่องคำนวณเดิม
2. เมื่อคำนวณ position รวม ระบบจะต้องรวม quantity และคำนวณ average entry price ที่ถูกต้อง
3. เมื่อคำนวณ margin ระบบจะต้องใช้ leverage และ maintenance margin rate ที่ถูกต้อง
4. เมื่อมีหลาย position ระบบจะต้องคำนวณ total notional value และใช้ maintenance tier ที่เหมาะสม
5. เมื่อคำนวณเสร็จ ระบบจะต้องแสดงผลลัพธ์ที่ตรงกับการคำนวณของ Binance